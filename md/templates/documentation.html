{% extends 'base.html' %}
{% set app = 'data' %}

{% block content %}
    <style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 1200px;
        margin: 0 auto;
    }

    .nav-container {
        position: static;
        top: 0;
        background: #fff;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 40px;
        z-index: 1000;
    }

    .nav-title {
        font-size: 24px;
        margin-bottom: 20px;
        color: #2c3e50;
    }

    .nav-links {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .nav-section {
        flex: 1;
        min-width: 250px;
    }

    .nav-section h3 {
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .nav-section ul {
        list-style: none;
    }

    .nav-section li {
        margin-bottom: 8px;
    }

    .nav-section a {
        text-decoration: none;
        color: #3498db;
        transition: color 0.3s;
    }

    .nav-section a:hover {
        color: #2980b9;
    }

    .active-link {
        font-weight: bold;
        color: #421a70 !important;
    }

    .content-section {
        margin-bottom: 40px;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .content-section h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3498db;
    }

    .content-section h3 {
        color: #2c3e50;
        margin: 20px 0 10px;
    }

    #backToTop {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #343a40;
        color: white;
        border: none;
        border-radius: 50%;
        padding: 10px;
        font-size: 18px;
        cursor: pointer;
        display: none;
        transition: opacity 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #backToTop:hover {
        background-color: #0056b3;
    }

    .json-structure {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        font-family: monospace;
        white-space: pre-wrap;
        margin: 20px 0;
    }
    </style>

    <nav class="nav-container">
        <h2 class="nav-title">User Manual Contents</h2>
        <div class="nav-links">
            <div class="nav-section">
                <h3>Introduction</h3>
                <ul>
                    <li><a href="#overview">Overview</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3>Browse</h3>
                <ul>
                    <li><a href="#browse-datastructure">Datastructure</a></li>
                    <li><a href="#browse-instance">Instance</a></li>
                    <li><a href="#browse-dataset">Dataset</a></li>
                    <li><a href="#browse-format">Format</a></li>
                    <li><a href="#browse-formatter">Formatter</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3>Create</h3>
                <ul>
                    <li><a href="#create-datastructure">Datastructure</a></li>
                    <li><a href="#create-instance">Instance</a></li>
                    <li><a href="#create-dataset">Dataset</a></li>
                    <li><a href="#create-format">Format</a></li>
                    <li><a href="#create-formatter">Formatter</a></li>
                </ul>
            </div>
            {% if current_user.has_role('admin') %}
            <div class="nav-section">
                <h3>Edit</h3>
                <ul>
                    <li><a href="#edit-datastructure">Datastructure</a></li>
                    <li><a href="#edit-instance">Instance</a></li>
                    <li><a href="#edit-dataset">Dataset</a></li>
                    <li><a href="#edit-format">Format</a></li>
                    <li><a href="#edit-formatter">Formatter</a></li>
                </ul>
            </div>
            {% endif %}
        </div>
    </nav>

    <button id="backToTop"><i class="fa fa-arrow-up"></i></button>

    <main>
        <section id="overview" class="content-section">
            <h2>Overview</h2>
            <p>This user manual provides comprehensive guidance on how to use the MathDataLanguage system. The system allows you to manage mathematical data through various components including datastructures, instances, datasets, formats, and formatters.</p>
            
            <h3>Data Structure Format</h3>
            <p>Below is the standard JSON structure used in the system:</p>
            <div class="json-structure">
                {
                    "name": String,
                    "plural": String,
                    "attribute_types": {
                        "attribute_type_1": true,
                        "attribute_type_2": false
                    },
                    "options": {
                        "option_1": Type,
                        "option_2": Type
                    },
                    "raw_types": {
                        "raw_type_1": false,
                        "raw_type_2": true
                    },
                    "sizes": {
                        "size_1": integer,
                        "size_2": integer
                    },
                    "raw": {
                        "raw_type_2": {
                            "attribute_type_1": {
                                "structure": ["@sizes.size_1"],
                                "element": {
                                    "type": Type
                                }
                            }
                        }
                    },
                    "features": {
                        "feature_1": Type
                    }
                }
            </div>
        </section>

        <section id="browse" class="content-section">
            <h2>Browse</h2>
        
            <section id="browse-datastructure">
                <h3>Datastructure</h3>
                <p>Navigate and view existing datastructures. Search and explore their details and relationships within the system.</p>
            </section>
        
            <section id="browse-instance">
                <h3>Instance</h3>
                <p>Search and view instances associated with datastructures. Check their status and attributes.</p>
            </section>
        
            <section id="browse-dataset">
                <h3>Dataset</h3>
                <p>Explore datasets linked to datastructures and instances. Filter and access datasets for further analysis.</p>
            </section>
        
            <section id="browse-format">
                <h3>Format</h3>
                <p>View available formats. Check the structure and organization of data used in the system.</p>
            </section>
        
            <section id="browse-formatter">
                <h3>Formatter</h3>
                <p>View existing formatters and their role in data transformation within the system.</p>
            </section>
        </section>
        
        <section id="create" class="content-section">
            <h2>Create</h2>
        
            <section id="create-datastructure">
                <h3>Datastructure</h3>
                <p>Create new datastructures by defining their attributes and relationships.</p>
            </section>
        
            <section id="create-instance">
                <h3>Instance</h3>
                <p>Create new instances based on datastructures by assigning specific data values.</p>
            </section>
        
            <section id="create-dataset">
                <h3>Dataset</h3>
                <p>Create new datasets and associate them with instances and datastructures.</p>
            </section>
        
            <section id="create-format">
                <h3>Format</h3>
                <p>Define new data formats to structure datasets and instances.</p>
            </section>
        
            <section id="create-formatter">
                <h3>Formatter</h3>
                <p>Create new formatters to transform data between different formats.</p>
            </section>
        </section>
        
        {% if current_user.has_role('admin') %}
        <section id="edit" class="content-section">
            <h2>Edit</h2>
        
            <section id="edit-datastructure">
                <h3>Datastructure</h3>
                <p>Edit existing datastructures, modify attributes, and adjust relationships.</p>
            </section>
        
            <section id="edit-instance">
                <h3>Instance</h3>
                <p>Update and modify instances by changing their data and associations.</p>
            </section>
        
            <section id="edit-dataset">
                <h3>Dataset</h3>
                <p>Edit datasets, update contents, or modify associations with datastructures.</p>
            </section>
        
            <section id="edit-format">
                <h3>Format</h3>
                <p>Modify existing formats to adjust data structure and compatibility.</p>
            </section>
        
            <section id="edit-formatter">
                <h3>Formatter</h3>
                <p>Edit formatters to update data transformation rules and techniques.</p>
            </section>
        </section>
        {% endif %}
        

    </main>

    <script>
        function highlightLink(clickedLink) {
            document.querySelectorAll('.active-link').forEach(link => {
                link.classList.remove('active-link');
            });
            clickedLink.classList.add("active-link");
        }

        document.querySelectorAll("a[href^='#']").forEach((link) => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                
                const targetId = link.getAttribute("href");
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                    });

                    history.pushState(null, null, targetId);
                    highlightLink(link);
                }
            });
        });

        const backToTopButton = document.getElementById('backToTop');

        window.onscroll = function () {
            if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
                backToTopButton.style.display = 'block';
            } else {
                backToTopButton.style.display = 'none';
            }
        };

        backToTopButton.onclick = function () {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        };
    </script>
{% endblock %}